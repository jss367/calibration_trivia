(()=>{function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}function n(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(e){if("string"==typeof e)return o(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?o(e,n):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,n){(null==n||n>e.length)&&(n=e.length);for(var o=0,t=Array(n);o<n;o++)t[o]=e[o];return t}console.log("App Version:","1.2.2");var t=document.getElementById("quiz-container"),c=document.getElementById("question-container"),r=document.getElementById("next-button"),s=document.getElementById("results-container"),l=document.getElementById("username-container"),i=document.getElementById("start-quiz"),a=(document.getElementById("leaderboard-container"),document.getElementById("category-selection-container")),d=document.getElementById("session-id-selection-container"),u=document.getElementById("mode-selection-container"),m=document.getElementById("mode-single"),y=document.getElementById("mode-group-participant"),p=document.getElementById("mode-group-questioner"),g=document.getElementById("question-count-container"),f=document.getElementById("start-button-container"),h=document.getElementById("session-id-container"),v=firebase.firestore(),b=0,E=[],I=0,k=0,w=[],S=[],q=[];function B(){var e=document.querySelector('input[name="mode"]:checked').value;localStorage.setItem("selectedMode",e),l.style.display="group-participant"===e?"block":"none",d.style.display="group-participant"===e?"block":"none",h.style.display="group-questioner"===e?"block":"none",a.style.display=["single","group-questioner"].includes(e)?"block":"none",g.style.display=["single","group-questioner"].includes(e)?"block":"none",L()}function L(){var e=document.querySelector('input[name="mode"]:checked'),n=e?e.value:"",o=document.getElementById("username").value.trim(),t=document.getElementById("session-id").value.trim(),c=Array.from(document.querySelectorAll(".category-checkbox")).some((function(e){return e.checked})),r=!1;"single"===n?r=c:"group-questioner"===n?r=t&&c:"group-participant"===n&&(r=o.length>0),document.getElementById("start-quiz").disabled=!r}function M(){console.log("inside updateNextButton");var e=document.getElementById("session-id").value.trim(),n=document.querySelectorAll(".category-checkbox"),o=Array.from(n).some((function(e){return e.checked}));r.disabled=!(e.length>0&&o)}function x(e){return v.collection("sessions").doc(e).get().then((function(e){if(!e.exists)throw console.log("No such session!"),new Error("No such session");if(console.log("Fetched document:",e.data()),!(e.data().questions&&e.data().questions.length>0))throw console.log("No questions available in this session!"),new Error("No questions available");E=e.data().questions})).catch((function(e){throw console.error("Error loading session questions:",e),e}))}function A(e){for(var n=e.length-1;n>0;n--){var o=Math.floor(Math.random()*(n+1)),t=[e[o],e[n]];e[n]=t[0],e[o]=t[1]}}function Q(e){if(E[e]){var n,o=E[e],r=document.createElement("div");n=o.options.map((function(e,n){return"\n    <div>\n      <label>".concat(String.fromCharCode(65+n),": ").concat(e,"</label>\n    </div>\n  ")})).join(""),r.innerHTML="\n    <h3>Question ".concat(e+1," of ").concat(E.length,"</h3>\n    <h2>").concat(o.question,"</h2>\n    ").concat(n,"\n  "),c.innerHTML="",c.appendChild(r),t.style.display="block"}else console.error("Question not found for index: ",e)}function C(){var e=document.getElementById("session-id-select").value;e?localStorage.setItem("currentSessionId",e):console.error("No session selected.")}function P(e){if(E[e]){var n,o=E[e],t=document.createElement("div"),s=["A","B","C","D"];n=o.options.map((function(e,n){return'\n    <div>\n      <input type="radio" id="option-'.concat(s[n],'" class="input-radio" name="answer" value="').concat(e,'">\n      <label for="option-').concat(s[n],'">').concat(s[n],": ").concat(e,"</label>\n    </div>\n  ")})).join(""),t.innerHTML="\n    <h3>Question ".concat(e+1," of ").concat(E.length,"</h3>\n    <h2>").concat(o.question,"</h2>\n    ").concat(n,"\n    ").concat('\n    <div>\n      <label for="confidence">Confidence:</label>\n      <input type="number" id="confidence" class="input-small" min="0" max="100" step="1">%\n    </div>\n  ',"\n  "),c.innerHTML="",c.appendChild(t),r.style.display="block"}else console.error("Question not found for index: ",e)}function T(e){if(E[e]){var n=E[e],o=document.createElement("div"),s=n.options.map((function(e,n){return'\n    <div>\n      <input type="radio" id="option-'.concat(n,'" class="input-radio" name="answer" value="').concat(e,'">\n      <label for="option-').concat(n,'">').concat(String.fromCharCode(65+n),": ").concat(e,"</label>\n    </div>\n  ")})).join("");o.innerHTML="\n    <h3>Question ".concat(e+1," of ").concat(E.length,"</h3>\n    ").concat(s,"\n    ").concat('\n    <div>\n      <label for="confidence">Confidence:</label>\n      <input type="number" id="confidence" class="input-small" min="0" max="100" step="1">%\n    </div>\n  ',"\n  "),c.innerHTML="",c.appendChild(o),t.style.display="block",r.style.display="block"}else console.error("Question not found for index: ",e)}function H(){console.log("Inside submitAnswer");var e=document.querySelector('input[name="answer"]:checked'),n=document.getElementById("confidence"),o=null,t=null;if(e&&(o=e.value),n&&(t=parseInt(n.value,10),t=Math.max(0,Math.min(t,100)),t=Math.round(t)/100),!e||isNaN(t))console.warn("No answer or invalid confidence selected for current question");else{var c=E[b].correctAnswer;c===o?(I++,k+=Math.pow(1-t,2)):k+=Math.pow(0-t,2),w.push(o),S.push(c),q.push(t);var r=N(),s=document.getElementById("username").value.trim();s&&r&&function(e,n,o,t){if(e&&n){var c={answer:o,confidence:t,timestamp:firebase.firestore.FieldValue.serverTimestamp()};v.collection("sessions").doc(e).collection("answers").doc(n).set(c).then((function(){return console.log("Answer submitted successfully")})).catch((function(e){return console.error("Error submitting answer:",e)}))}else console.error("Session ID or User ID is missing.")}(r,s,o,t),e&&(e.checked=!1),n&&(n.value="")}}function N(){return localStorage.getItem("currentSessionId")}function j(){if(t.style.display="none",p.checked)d=N(),v.collection("sessions").doc(d).collection("answers").get().then((function(e){var n={};e.forEach((function(e){var o=e.data(),t=e.id;n[t]||(n[t]={correct:0,total:0}),E[n[t].total].correctAnswer===o.answer&&n[t].correct++,n[t].total++}));var o=document.getElementById("leaderboard-container");o.innerHTML="<h2>Leaderboard</h2>",Object.keys(n).forEach((function(e){var t=n[e],c=document.createElement("p");c.innerText="".concat(e,": ").concat(t.correct," / ").concat(t.total),o.appendChild(c)})),o.style.display="block"})).catch((function(e){console.error("Error getting documents: ",e)}));else{var n,o;(k/=E.length)<=.1?(n="Excellent",o="green"):k<=.2?(n="Good",o="blue"):k<=.3?(n="Fair",o="orange"):(n="Poor",o="red");var c=(r=w.map((function(e,n){return{userAnswer:e,correctAnswer:S[n],userConfidence:q[n]}})),l=Array(10).fill(0),i=Array(10).fill(0),a=Array(10).fill(0),r.forEach((function(e){var n=Math.min(Math.floor(10*e.userConfidence),9);i[n]++,e.correctAnswer===e.userAnswer&&a[n]++})),l.map((function(e,n){return{decileRange:"".concat(10*n,"-").concat(10*(n+1),"%"),score:i[n]?a[n]/i[n]:null,correct:a[n],total:i[n]}})));s.innerHTML="\n      <h2>Results</h2>\n      <p>Correct answers: ".concat(I," / ").concat(E.length,'</p>\n      <p style="color:').concat(o,';">Brier score: ').concat(k.toFixed(2)," (").concat(n,")</p>\n      ").concat(c.map((function(e){var n=e.decileRange,o=e.score,t=e.correct,c=e.total;return 0===c?"<p>You did not answer any questions with ".concat(n,"% confidence.</p>"):"<p>When you were ".concat(n,"% confident, you were correct ").concat(Math.round(100*o),"% of the time (").concat(t,"/").concat(c,").</p>")})).join(""),"\n    "),s.style.display="block",function(){for(var n=0;n<E.length;n++){var o=document.createElement("p");if("object"===e(S[n])){var t=w[n].toString(),c=S[n].includes(t);o.style.color=c?"green":"red",o.innerHTML="Question ".concat(n+1,": ").concat(E[n].question,"<br>Your answer was ").concat(t," with ").concat(100*q[n],"% confidence.<br>The correct answer is ").concat(S[n],".")}else{var r=S[n]===w[n];o.style.color=r?"green":"red",o.innerHTML="Question ".concat(n+1,": ").concat(E[n].question,"<br>Your answer was ").concat(w[n]," with ").concat(100*q[n],"% confidence.<br>The correct answer is ").concat(S[n],".")}s.appendChild(o)}}()}var r,l,i,a,d}u.addEventListener("change",(function(e){f.style.display="flex","group-questioner"===e.target.value?(h.style.display="block",a.style.display="block",g.style.display="block",d.style.display="none",l.style.display="none",document.getElementById("start-quiz").disabled=!1,i.removeEventListener("click",C),r.disabled=!0,document.getElementById("session-id").addEventListener("input",M),document.querySelectorAll(".category-checkbox").forEach((function(e){e.addEventListener("change",M)}))):"group-participant"===e.target.value?(h.style.display="none",l.style.display="block",d.style.display="block",v.collection("sessions").where("active","==",!0).get().then((function(e){var n=document.getElementById("session-id-select");n.innerHTML="",e.forEach((function(e){var o=document.createElement("option");o.value=e.id,o.textContent=e.id,n.appendChild(o)}))})).catch((function(e){return console.error("Error fetching sessions:",e)})),g.style.display="none",a.style.display="none",i.removeEventListener("click",C),i.addEventListener("click",C)):"single"===e.target.value?(h.style.display="none",l.style.display="none",g.style.display="block",a.style.display="block",d.style.display="none",document.getElementById("start-quiz").disabled=!1,i.removeEventListener("click",C)):(g.style.display="none",a.style.display="none",d.style.display="none",document.getElementById("start-quiz").disabled=!0,i.removeEventListener("click",C))})),document.getElementById("username").addEventListener("input",(function(){var e=this.value.trim(),n=document.getElementById("start-quiz");e.length>0||p.checked?n.disabled=!1:n.disabled=!0})),document.getElementById("start-quiz").disabled=!p.checked,i.addEventListener("click",(function(){var e=document.querySelector('input[name="mode"]:checked').value;if(console.log("Selected Mode: ",e),l.style.display="none",u.style.display="none",f.style.display="none",g.style.display="none",a.style.display="none","single"===e){console.log("Starting Single Player Mode");var o="Player_"+Math.floor(1e4*Math.random()).toString().padStart(4,"0");localStorage.setItem("username",o),t.style.display="block",function(){console.log("inside loadQuestionsSingle");var e=parseInt(document.getElementById("question-count").value,10),o=document.querySelectorAll(".category-checkbox"),t=Array.from(o).filter((function(e){return e.checked})).map((function(e){return e.value}));if(0!==t.length){var c=t.map((function(e){return fetch(e).then((function(n){if(!n.ok)throw new Error("Network response was not ok for file ".concat(e));return n.json().catch((function(n){throw new Error("Invalid JSON in file ".concat(e,": ").concat(n.message))}))}))}));Promise.all(c).then((function(o){var t;A(E=(t=[]).concat.apply(t,n(o))),E=E.slice(0,e),console.log("modeSinglePlayer.checked is ",m.checked),console.log("modeGroupParticipant.checked is ",y.checked),console.log("modeGroupQuestioner.checked is ",p.checked),m.checked&&P(b)})).catch((function(e){console.error("Error loading questions:",e.message)}))}else console.log("Please select at least one category.")}()}else if("group-participant"===e){console.log("Starting Group Participant Mode");var c=document.getElementById("session-id-select").value;c?(localStorage.setItem("currentSessionId",c),window.location.href="/".concat(c,"?role=responder")):console.log("Please select a session.")}else if("group-questioner"===e){console.log("Starting Group Questioner Mode");var r=document.getElementById("session-id").value.trim();if(r){var s=parseInt(document.getElementById("question-count").value,10),i=document.querySelectorAll(".category-checkbox"),d=Array.from(i).filter((function(e){return e.checked})).map((function(e){return e.value}));if(0===d.length)return void console.log("Please select at least one category.");var h=d.map((function(e){return fetch(e).then((function(n){if(!n.ok)throw new Error("Network response was not ok for file ".concat(e));return n.json().catch((function(n){throw new Error("Invalid JSON in file ".concat(e,": ").concat(n.message))}))}))}));Promise.all(h).then((function(e){var o;return A(E=(o=[]).concat.apply(o,n(e))),E=E.slice(0,s),v.collection("sessions").doc(r).set({questions:E,active:!0,currentQuestionIndex:0})})).then((function(){console.log("Session ID set successfully:",r),localStorage.setItem("currentSessionId",r),window.location.href="/".concat(r,"?role=questioner")})).catch((function(e){return console.error("Error setting session ID or loading questions:",e)}))}else console.log("Please enter a session ID.")}})),r.classList.add("button-spacing"),r.addEventListener("click",(function(){if(console.log("Next button has been clicked"),console.log("Current Mode:"),console.log("  Single Player:",m.checked),console.log("  Group Participant:",y.checked),console.log("  Group Questioner:",p.checked),console.log("Current Question Index:",b),console.log("Total Questions:",E.length),console.log("User Answers:",w),console.log("Correct Answers:",S),console.log("User Confidences:",q),console.log("Score:",I),console.log("Brier Score:",k),p.checked)console.log("Handling Group Questioner mode"),b++,console.log("Updated Question Index (Questioner):",b),b<E.length?Q(b):j();else if(y.checked){console.log("Handling Group Participant mode"),H();var e=N();console.log("Session ID:",e),++b<E.length?T(b):j()}else console.log("Handling Single Player mode"),H(),b++,console.log("Updated Question Index (Single Player):",b),b<E.length?P(b):j()})),document.addEventListener("DOMContentLoaded",(function(){u.addEventListener("change",B),document.getElementById("username").addEventListener("input",L),document.getElementById("session-id").addEventListener("input",L),document.querySelectorAll(".category-checkbox").forEach((function(e){e.addEventListener("change",L)})),L();var e=localStorage.getItem("selectedMode");e&&(document.getElementById("mode-".concat(e)).checked=!0,B());var n,o=window.location.pathname.split("/").filter((function(e){return e}))[0],c=new URLSearchParams(window.location.search).get("role");o&&(console.log("Session ID from URL:",o),localStorage.setItem("currentSessionId",o),"questioner"===c?x(n=o).then((function(){Q(b=0),t.style.display="block",u.style.display="none",f.style.display="none",g.style.display="none",a.style.display="none",h.style.display="block",h.innerHTML="<p>Session ID: ".concat(n,"</p>"),r.style.display="block",r.disabled=!1})).catch((function(e){console.error("Error displaying questioner screen:",e)})):"responder"===c&&function(e){x(e).then((function(){t.style.display="block",u.style.display="none",f.style.display="none",l.style.display="none",h.style.display="none",T(b=0),function(e){v.collection("sessions").doc(e).onSnapshot((function(e){if(e.exists){var n=e.data();void 0!==n.currentQuestionIndex&&n.currentQuestionIndex!==b&&(o=n,console.log("Inside onQuestionIndexUpdated"),void 0!==o.currentQuestionIndex&&o.currentQuestionIndex!==b&&(y.checked&&H(),T(b=o.currentQuestionIndex)))}else console.error("No such session!");var o}))}(e)})).catch((function(e){console.error("Error displaying responder screen:",e)}))}(o))}))})();